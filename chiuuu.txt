-- Chờ game load hoàn toàn
if not game:IsLoaded() then game.Loaded:Wait() end

local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Window = Fluent:CreateWindow({
    Title = "Apple Hub | chii Hauu Edition",
    SubTitle = "Delta Optimized",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = false, 
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl 
})

-- // CẤU HÌNH //
_G.AutoFarm = false
_G.Weapon = "Melee"
_G.DistanceMob = 10

-- // HÀM NHẬN QUEST //
local function GetQuest()
    local lvl = game:GetService("Players").LocalPlayer.Data.Level.Value
    if lvl >= 1 and lvl <= 9 then
        return {"BanditQuest1", "Bandit", CFrame.new(1059, 15, 1550)}
    elseif lvl >= 10 and lvl <= 14 then
        return {"MonkeyQuest1", "Monkey", CFrame.new(-1598, 35, 153)}
    elseif lvl >= 15 and lvl <= 29 then
        return {"GorillaQuest1", "Gorilla", CFrame.new(-1598, 35, 153)}
    else
        return {"BanditQuest1", "Bandit", CFrame.new(1059, 15, 1550)}
    end
end

-- // VŨ KHÍ //
function EquipWeapon()
    pcall(function()
        local bp = game.Players.LocalPlayer.Backpack
        local char = game.Players.LocalPlayer.Character
        if not char:FindFirstChild(_G.Weapon) then
            for _, v in pairs(bp:GetChildren()) do
                if v:IsA("Tool") and (v.ToolTip == _G.Weapon or v.Name:find(_G.Weapon)) then
                    char.Humanoid:EquipTool(v)
                end
            end
        end
    end)
end

-- // TWEEN DI CHUYỂN //
function TweenTo(Pos)
    local char = game.Players.LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        local dist = (Pos.Position - char.HumanoidRootPart.Position).Magnitude
        game:GetService("TweenService"):Create(char.HumanoidRootPart, TweenInfo.new(dist/300, Enum.EasingStyle.Linear), {CFrame = Pos}):Play()
    end
end

-- // VÒNG LẶP FARM //
spawn(function()
    while task.wait() do
        if _G.AutoFarm then
            pcall(function()
                local playerGui = game:GetService("Players").LocalPlayer.PlayerGui
                if not playerGui.Main:FindFirstChild("Quest") then
                    local q = GetQuest()
                    TweenTo(q[3])
                    if (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - q[3].Position).Magnitude < 15 then
                        task.wait(0.5)
                        game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("StartQuest", q[1], 1)
                    end
                else
                    local q = GetQuest()
                    local enemy = nil
                    for i,v in pairs(game.Workspace.Enemies:GetChildren()) do
                        if v.Name == q[2] and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
                            enemy = v
                            break
                        end
                    end
                    
                    if enemy and enemy:FindFirstChild("HumanoidRootPart") then
                        EquipWeapon()
                        TweenTo(enemy.HumanoidRootPart.CFrame * CFrame.new(0, _G.DistanceMob, 0))
                        game:GetService("VirtualUser"):Button1Down(Vector2.new(1280, 672))
                    else
                        -- Đợi quái hồi
                        TweenTo(GetQuest()[3] * CFrame.new(0, 50, 0))
                    end
                end
            end)
        end
    end
end)

-- // GIAO DIỆN //
local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "home" })
}

Tabs.Main:AddDropdown("WeaponDropdown", {
    Title = "Chọn Vũ Khí",
    Values = {"Melee", "Sword", "Blox Fruit"},
    Default = "Melee",
    Callback = function(Value)
        _G.Weapon = Value
    end
})

Tabs.Main:AddToggle("AutoFarmToggle", {
    Title = "Bật Auto Farm Level",
    Default = false,
    Callback = function(Value)
        _G.AutoFarm = Value
    end
})

Tabs.Main:AddSlider("DistanceSlider", {
    Title = "Khoảng cách đứng",
    Default = 10,
    Min = 5,
    Max = 25,
    Rounding = 0,
    Callback = function(Value)
        _G.DistanceMob = Value
    end
})

-- Nút nổi hỗ trợ Delta (Nhấn để hiện lại menu)
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local Toggle = Instance.new("TextButton", ScreenGui)
Toggle.Size = UDim2.new(0, 60, 0, 30)
Toggle.Position = UDim2.new(0, 10, 0, 150)
Toggle.Text = "Ẩn/Hiện"
Toggle.BackgroundColor3 = Color3.fromRGB(0, 255, 100)
Toggle.Draggable = true
Toggle.MouseButton1Click:Connect(function()
    game:GetService("VirtualInputManager"):SendKeyEvent(true, Enum.KeyCode.LeftControl, false, game)
end)

Fluent:Notify({
    Title = "Apple Hub",
    Content = "Chào chii Hauu, menu đã bật!",
    Duration = 5
})

Window:SelectTab(1)
